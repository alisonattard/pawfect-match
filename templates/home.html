<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        push,
        get,
        child,
      } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBGC1w5CI59ZwR4ueKHUXJ792fqm4XAgGE",
        authDomain: "padawans-9bae0.firebaseapp.com",
        databaseURL:
          "https://padawans-9bae0-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "padawans-9bae0",
        storageBucket: "padawans-9bae0.appspot.com",
        messagingSenderId: "570564755420",
        appId: "1:570564755420:web:fd7f79aa11560a3fb79919",
        measurementId: "G-CR67JNKHGD",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);

      let pet = null;

      document.querySelector(".cat").addEventListener("click", function () {
        document.querySelector(".dog").style.transition = "opacity 0.5s";
        document.querySelector(".dog").style.opacity = "0.5";
        document.querySelector(".cat").style.opacity = "1";
        pet = "cat";
      });

      document.querySelector(".dog").addEventListener("click", function () {
        document.querySelector(".cat").style.transition = "opacity 0.5s";
        document.querySelector(".cat").style.opacity = "0.5";
        document.querySelector(".dog").style.opacity = "1";
        pet = "dog";
      });

      document
        .getElementById("generateButton")
        .addEventListener("click", async function () {
          // Collect form data
          const formData = new FormData(
            document.getElementById("descriptionForm")
          );
          const data = {};
          formData.forEach((value, key) => {
            if (data[key]) {
              if (!Array.isArray(data[key])) {
                data[key] = [data[key]];
              }
              data[key].push(value);
            } else {
              data[key] = value;
            }
          });

          // Add selected pet to data
          data.pet = pet;

          // Save data to Firebase
          const newRef = push(ref(database, "formData"), data);

          // Fetch the form data from Firebase
          const snapshot = await get(
            child(ref(database), `formData/${newRef.key}`)
          );
          if (snapshot.exists()) {
            const fetchedData = snapshot.val();
            const list = [
              fetchedData.pet,
              fetchedData.age,
              fetchedData.size,
              fetchedData.gender,
              fetchedData.characteristics,
            ];

            // Send the list to the /generate_description endpoint
            const response = await fetch("/generate_description", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ prompt: list.join(", ") }),
            });

            const result = await response.json();
            if (result.description) {
              document.getElementById("generatedDescription").innerText =
                result.description;
            }
          }

          // Display notification
          const notification = document.getElementById("notification");
          notification.style.display = "block";
          setTimeout(() => {
            notification.style.display = "none";
          }, 3000);
        });
    </script>
  </head>
  <body>
    <nav>
      <ul class="nav-list">
        <li>
          <a class="navtitle">
            The Pawfect Match
            <img
              class="paw"
              src="{{ url_for('static', filename='images/paw.png') }}"
            />
          </a>
        </li>
        <li><a class="navtext" href="{{ url_for('home') }}">Home</a></li>
        <li>
          <a class="navtext" href="{{ url_for('view') }}">Saved Descriptions</a>
        </li>
      </ul>
    </nav>
    <div class="form-container">
      <div class="image-container">
        <img
          src="{{ url_for('static', filename='images/cat.png') }}"
          class="cat"
          alt="Cat Image"
        />
        <img
          src="{{ url_for('static', filename='images/dog.png') }}"
          class="dog"
          alt="Dog Image"
        />
      </div>
      <form id="descriptionForm">
        <label class="inputtitle" for="imageUpload">Upload an image:</label>
        <input
          type="file"
          id="imageUpload"
          name="imageUpload"
          accept="image/*"
        />
        <label class="inputtitle" for="descriptionInput"
          >Add keywords or description:</label
        >
        <input
          type="text"
          id="descriptionInput"
          name="descriptionInput"
          placeholder="Add an initial description or keywords"
        />
        <label class="inputtitle" for="nameInput">Name (optional):</label>
        <input
          type="text"
          id="nameInput"
          name="nameInput"
          placeholder="Name (optional)"
        />
        <div class="form-row">
          <label class="selecttext" for="gender">Gender:</label>
          <select id="gender" name="gender">
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
          <label class="selecttext" for="age">Age:</label>
          <select id="age" name="age">
            <option value="baby">Baby</option>
            <option value="young">Young</option>
            <option value="teen">Teen</option>
            <option value="adult">Adult</option>
            <option value="elder">Elder</option>
          </select>

          <label class="selecttext" for="size">Size:</label>
          <select id="size" name="size">
            <option value="Small">Small</option>
            <option value="Medium">Medium</option>
            <option value="Large">Large</option>
            <option value="Extra Large">Extra Large</option>
          </select>
        </div>
        <fieldset>
          <legend>Characteristics:</legend>
          <div class="grid-container">
            <label
              ><input type="checkbox" name="characteristics" value="sweet" />
              Sweet</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="curious" />
              Curious</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="brave" />
              Brave</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="smart" />
              Smart</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="cuddly" />
              Cuddly</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="friendly" />
              Friendly</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="goofy" />
              Goofy</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="mellow" />
              Mellow</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="playful" />
              Playful</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="loyal" />
              Loyal</label
            >
            <label
              ><input
                type="checkbox"
                name="characteristics"
                value="independent"
              />
              Independent</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="gentle" />
              Gentle</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="funny" />
              Funny</label
            >
            <label
              ><input
                type="checkbox"
                name="characteristics"
                value="energetic"
              />
              Energetic</label
            >
            <label
              ><input type="checkbox" name="characteristics" value="shy" />
              Shy</label
            >
          </div>
        </fieldset>
        <div class="button-container">
          <button type="button" id="generateButton">
            <a class="btntext">Generate Description</a>
          </button>
          <button>
            <a class="viewbtntext" href="{{ url_for('view') }}"
              >View Saved Descriptions</a
            >
          </button>
        </div>
      </form>
      <div id="notification" style="display: none">Description generated!</div>
      <div id="generatedDescription" class="description-box"></div>
    </div>
  </body>
</html>
